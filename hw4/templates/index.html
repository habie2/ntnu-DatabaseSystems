{% extends 'layout.html' %}

{% block title %}My plants{% endblock %}

{% block content %}
<h2>My Registered Plants</h2>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <a href="{{ url_for('add_plant') }}" class="btn" style="margin-bottom: 0;">Add New Plant</a>

    <!-- BOTÓN MULTI-DELETE -->
    <!-- El atributo 'form' conecta este botón con el formulario invisible de abajo -->
    <button type="submit" form="multi-delete-form" class="btn-delete-multi">
        Delete Selected
    </button>
</div>

<!-- FORMULARIO INVISIBLE (Lógica del Multi-Delete) -->
<!-- Está vacío aquí para no romper el diseño, pero recibirá los datos de los checkboxes -->
<form id="multi-delete-form" action="{{ url_for('delete_multiple') }}" method="POST"
    onsubmit="return confirm('Are you sure you want to delete the selected plants?');">
</form>

{% if plants %}
<div class="plant-grid-container">

    {% for plant in plants %}
    <div class="plant-card">

        <!-- CHECKBOX DE SELECCIÓN -->
        <!-- El atributo form="multi-delete-form" envía este dato al formulario invisible de arriba -->
        <div class="checkbox-wrapper">
            <input type="checkbox" name="plant_ids" value="{{ plant['_id'] }}" form="multi-delete-form"
                class="plant-checkbox">
        </div>

        {% if plant['image_url'] %}
        <img src="{{ url_for('static', filename=plant['image_url']) }}" alt="{{ plant['name'] }}"
            class="plant-card-img">
        {% else %}
        <div class="plant-card-img-placeholder">
            <span>No image</span>
        </div>
        {% endif %}

        <div class="plant-card-body">
            <strong>{{ plant['name'] }}</strong>
            (<em>Species: {{ plant['species'] }}</em>)
            <br>

            <span class="plant-date">
                Last watered: {{ plant['last_watered'].strftime('%d/%m/%Y a las %I:%M %p') }}
            </span>
            <br>

            <!-- Formulario de Regar (Individual) -->
            <form action="{{ url_for('water_plant', plant_id=plant['_id']) }}" method="POST" style="margin-top: 10px;">
                <button type="submit" class="btn-water">
                    Water
                </button>
            </form>

            <!-- Formulario de Borrar (Individual) -->
            <form action="{{ url_for('delete_plant', plant_id=plant['_id']) }}" method="POST" style="margin-top: 5px;"
                onsubmit="return confirm('Are you sure you want to delete this plant?');">

                <button type="submit" class="btn-delete">
                    Delete
                </button>
            </form>
        </div>

    </div>
    {% endfor %}
</div>
{% else %}
<div class="no-plants-message">
    You have no registered plants. Add one!
</div>
{% endif %}

{% endblock %}
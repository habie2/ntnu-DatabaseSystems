{% extends 'layout.html' %}

{% block title %}My Plants{% endblock %}

{% block content %}

{% if current_user.is_authenticated %}
<h2>{{ current_user.username }}'s Plants</h2>
{% else %}
<h2>My Registered Plants</h2>
{% endif %}

{% if plants %}
<div class="plant-grid-container">
    {% for plant in plants %}
    <div class="plant-card">

        <img src="{{ url_for('static', filename=plant['image_url']) }}" alt="{{ plant['name'] }}"
            class="plant-card-img">

        <div class="plant-card-body">
            <!-- Link to Detail Page -->
            <a href="{{ url_for('plant_detail', plant_id=plant['_id']) }}" class="plant-card-title-link">
                <h3>{{ plant['name'] }}</h3>
            </a>

            <p><em>Species: {{ plant['species'] }}</em></p>

            <span class="plant-date">
                Last Watered: {{ plant['last_watered'].strftime('%b %d, %Y at %I:%M %p') }}
            </span>
            <span class="plant-date">
                Registered: {{ plant['created_at'].strftime('%b %d, %Y') }}
            </span>

            <div class="plant-card-actions">
                <form action="{{ url_for('water_plant', plant_id=plant['_id']) }}" method="POST">
                    <button type="submit" class="btn-action btn-water">Water</button>
                </form>

                <a href="{{ url_for('edit_plant', plant_id=plant['_id']) }}" class="btn-action btn-edit">Edit</a>

                <form action="{{ url_for('delete_plant', plant_id=plant['_id']) }}" method="POST"
                    onsubmit="return confirm('Are you sure you want to delete this plant?');">
                    <button type="submit" class="btn-action btn-delete">Delete</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- NEW: Delete All Plants Button (Dangerous Action) -->
{% if current_user.is_authenticated %}
<div style="margin-top: 3rem; border-top: 1px solid #ddd; padding-top: 2rem; text-align: center;">
    <p style="color: var(--dark-gray); margin-bottom: 1rem;">Danger Zone</p>
    <form action="{{ url_for('delete_all_plants') }}" method="POST"
        onsubmit="return confirm('WARNING: Are you sure you want to delete ALL your plants? This action cannot be undone.');">
        <button type="submit" class="btn btn-delete" style="background-color: #880000;">Delete All My Plants</button>
    </form>
</div>
{% endif %}

{% else %}
{% if current_user.is_authenticated %}
<div class="no-plants-message">
    You have no plants registered yet. Add one!
</div>
{% else %}
<div class="no-plants-message">
    Please <a href="{{ url_for('login') }}">log in</a> or <a href="{{ url_for('register') }}">register</a> to add and
    see your plants.
</div>
{% endif %}
{% endif %}

{% endblock %}